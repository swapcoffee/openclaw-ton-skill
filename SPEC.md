# OpenClaw TON Skill — Техническое задание

## Обзор

OpenClaw-скилл для полноценной работы с блокчейном TON. Позволяет агенту управлять кошельками, торговать токенами, работать с NFT, анализировать рынок и зарабатывать на DeFi — всё через естественный язык.

## Используемые API

| API | Назначение | Документация |
|-----|-----------|--------------|
| **swap.coffee** | DEX-агрегатор (свапы, роутинг), Yield-агрегатор (пулы, доходности) | [docs.swap.coffee](https://docs.swap.coffee) |
| **TonAPI** | Кошельки, балансы, транзакции, NFT, эмуляция, события | [tonapi.io/api-v2](https://tonapi.io/api-v2) |
| **DYOR** | Аналитика токенов, цены, пулы, рейтинг доверия, скам-детект | [docs.dyor.io](https://docs.dyor.io/ru/technical-guides/introduction) |
| **Marketapp** | NFT торговля (покупка, продажа, смена цены), гифты, коллекции | [api.marketapp.ws](https://api.marketapp.ws/docs) |
| **TON Docs** | Документация блокчейна TON (адреса, контракты, TVM, Jettons, NFT) | [docs.ton.org](https://docs.ton.org/) |

## Модули

### 1. Управление кошельками

- **Создание** неограниченного количества кошельков (генерация мнемоники)
- **Импорт** существующих кошельков (мнемоника / приватный ключ)
- **Лейблы и группировка** — именование кошельков ("основной", "трейдинг", "холодный")
- **Список кошельков** с балансами (TON + жетоны)
- **Адресная книга** — алиасы для часто используемых адресов
- **Шифрование** приватных ключей на диске (AES-256, пароль пользователя)

### 2. Балансы и мониторинг

- **Просмотр баланса** кошелька (TON, жетоны, NFT, общая стоимость в USD)
- **История транзакций** — входящие/исходящие, фильтрация по типу и периоду
- **Алерты** на изменения баланса (порог задаётся пользователем)
- **Подписка на события** кошелька (входящие переводы, свапы)

### 3. Переводы

- **Отправка TON** на адрес / алиас / .ton домен
- **Отправка жетонов** (Jettons) — USDT, NOT, DUST и др.
- **Мульти-переводы** — отправка нескольким адресам за одну операцию
- **Эмуляция перед отправкой** (TonAPI emulation):
  - Показать комиссию
  - Показать изменения балансов всех участников
  - Предупреждения о рисках (незнакомый адрес, большая сумма)
- **Подтверждение** — обязательный запрос подтверждения у пользователя перед любой транзакцией

### 4. Торговля (DEX)

- **Свап токенов** через swap.coffee агрегатор (оптимальный маршрут)
- **Мульти-свап** — обмен нескольких токенов одновременно
- **Информация о маршруте** — через какие DEX пойдёт, slippage, кэшбэк
- **Эмуляция свапа** — предпросмотр результата до исполнения
- **Статус транзакции** — отслеживание выполнения свапа

### 5. Аналитика токенов (DYOR)

- **Информация о токене** — цена, маркеткап, объём, ликвидность
- **Рейтинг доверия** — скам-скор, проверка контракта
- **История цены** — графики, тренды
- **DEX пулы** — в каких пулах торгуется, APY
- **История свапов** — кто и когда торговал
- **Сравнение токенов** — сравнить несколько токенов по метрикам

### 6. Yield / DeFi

- **Список пулов** через swap.coffee Yield-агрегатор (с APY, TVL, риском)
- **Добавление ликвидности** в пул
- **Вывод ликвидности** из пула
- **Позиции пользователя** — текущие позиции, заработок, PnL
- **Рекомендации** — подбор пулов по критериям (APY, риск, токен)

### 7. NFT

- **Просмотр коллекций** и отдельных NFT
- **NFT в кошельке** — список с превью
- **Покупка NFT** на маркетплейсах (getgems и др.)
- **Продажа / выставление на продажу**
- **Трансфер NFT** между кошельками
- **Floor price и статистика** коллекции

### 8. DNS (.ton домены)

- **Резолв** .ton домена в адрес
- **Информация** о домене (владелец, срок, DNS-записи)
- **Покупка** доменов

## Безопасность

### Критические правила

1. **Шифрование ключей** — приватные ключи и мнемоники хранятся только в зашифрованном виде
2. **Эмуляция обязательна** — перед любой транзакцией (отправка, свап, ликвидность, NFT) выполняется эмуляция и показывается пользователю
3. **Подтверждение обязательно** — пользователь должен явно подтвердить транзакцию после просмотра эмуляции
4. **Лимиты** — настраиваемые лимиты на транзакции (макс. сумма без доп. подтверждения)
5. **Никогда не логировать** приватные ключи, мнемоники, пароли

### Модель угроз

- Утечка ключей → шифрование + never log
- Ошибочная транзакция → эмуляция + подтверждение
- Скам-токены → проверка через DYOR перед свапом
- Фишинг-адреса → предупреждение при отправке на незнакомый адрес

## Архитектура скилла

```
openclaw-ton-skill/
├── SKILL.md                    # Основной файл скилла
├── SPEC.md                     # Это ТЗ
├── scripts/
│   ├── wallet.py               # Создание/импорт/управление кошельками
│   ├── transfer.py             # Переводы TON и жетонов
│   ├── swap.py                 # Свапы через swap.coffee
│   ├── yield.py                # Yield-агрегатор
│   ├── nft.py                  # Работа с NFT
│   ├── analytics.py            # Аналитика через DYOR
│   └── utils.py                # Общие утилиты (шифрование, форматирование)
├── references/
│   ├── swap-coffee-api.md      # Документация swap.coffee API
│   ├── tonapi.md               # Документация TonAPI
│   ├── dyor-api.md             # Документация DYOR API
│   └── security.md             # Гайд по безопасности
└── assets/
    └── (пока пусто)
```

## Примеры использования

```
Пользователь: Создай мне новый кошелёк для трейдинга
→ Создаёт кошелёк, сохраняет зашифрованно, показывает адрес

Пользователь: Какой у меня баланс?
→ Показывает баланс всех кошельков (TON + жетоны + USD)

Пользователь: Поменяй 10 TON на USDT
→ Строит маршрут через swap.coffee → эмулирует → показывает результат → ждёт подтверждения → исполняет

Пользователь: Что за токен DUST? Стоит ли покупать?
→ DYOR: цена, маркеткап, рейтинг доверия, пулы, тренд

Пользователь: Куда положить 100 TON под лучший процент?
→ Yield: топ пулов по APY с учётом риска → предлагает варианты → при согласии добавляет ликвидность

Пользователь: Покажи мои NFT
→ Список NFT во всех кошельках с превью и floor price

Пользователь: Отправь 5 TON на wallet.ton
→ Резолвит домен → эмулирует → показывает комиссию и итог → ждёт подтверждения
```

## Технические требования

- **Язык:** Python 3.9+
- **Зависимости:** минимальные (requests, cryptography)
- **Хранение:** `~/.openclaw/ton-skill/` (кошельки, конфиг, адресная книга)
- **API ключи:** конфигурируются при первом запуске
- **Совместимость:** OpenClaw 2026.2+
